<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Estimateur de Prix TCG - Pokémon Community</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
            min-height: 100vh;
        }
        .estimateur-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }
        .estimateur-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
        }
        .nav-link {
            transition: all 0.3s ease;
        }
        .nav-link:hover {
            color: #fbbf24;
            transform: translateY(-2px);
        }
        .search-input {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }
        .search-input:focus {
            background: rgba(255, 255, 255, 0.15);
            border-color: #fbbf24;
            box-shadow: 0 0 20px rgba(251, 191, 36, 0.3);
        }
        .price-badge {
            background: linear-gradient(135deg, #10b981, #059669);
        }
        .rarity-common { background: linear-gradient(135deg, #6b7280, #4b5563); }
        .rarity-uncommon { background: linear-gradient(135deg, #3b82f6, #1d4ed8); }
        .rarity-rare { background: linear-gradient(135deg, #f59e0b, #d97706); }
        .rarity-mythic { background: linear-gradient(135deg, #ef4444, #dc2626); }
        .rarity-secret { background: linear-gradient(135deg, #8b5cf6, #7c3aed); }
        .price-history-chart {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .loading-spinner {
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
<base target="_blank">
</head>
<body>
    <!-- Navigation -->
    <nav class="fixed top-0 w-full z-50 bg-slate-900/80 backdrop-blur-md border-b border-slate-700/50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-2">
                    <div class="w-8 h-8 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full flex items-center justify-center">
                        <i class="fas fa-bolt text-white text-sm"></i>
                    </div>
                    <span class="text-xl font-bold text-white">Pokémon Community</span>
                </div>
                <div class="hidden md:flex space-x-8">
                    <a href="index.html" class="nav-link text-slate-300 hover:text-white font-medium">Accueil</a>
                    <a href="test.html" class="nav-link text-slate-300 hover:text-white font-medium">Sailor Mélo</a>
                    <a href="pokedex.html" class="nav-link text-slate-300 hover:text-white font-medium">Pokédex</a>
                    <a href="dresseurs.html" class="nav-link text-slate-300 hover:text-white font-medium">Dresseurs</a>
                    <a href="forum.html" class="nav-link text-slate-300 hover:text-white font-medium">Forum</a>
                    <a href="calendrier.html" class="nav-link text-slate-300 hover:text-white font-medium">Calendrier</a>
                    <a href="quiz.html" class="nav-link text-slate-300 hover:text-white font-medium">Quiz</a>
                    <a href="estimateur.html" class="nav-link text-white font-medium">Estimateur</a>
                    <a href="collection.html" class="nav-link text-slate-300 hover:text-white font-medium">Classeur</a>
                    <a href="wishlist.html" class="nav-link text-slate-300 hover:text-white font-medium">Wishlist</a>
                </div>
                <div class="md:hidden">
                    <button class="text-white">
                        <i class="fas fa-bars"></i>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="pt-24 pb-12 bg-gradient-to-br from-slate-800/50 to-slate-900/50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-12">
                <h1 class="text-4xl md:text-6xl font-black text-white mb-6">
                    <span class="bg-gradient-to-r from-green-400 via-blue-500 to-purple-500 bg-clip-text text-transparent">
                        Estimateur
                    </span>
                    <span class="text-white"> de Prix TCG</span>
                </h1>
                <p class="text-xl text-slate-300 max-w-3xl mx-auto">Estimez la valeur de vos cartes Pokémon TCG avec précision et suivez l'évolution des prix</p>
            </div>
            
            <!-- Search Bar -->
            <div class="max-w-4xl mx-auto">
                <div class="relative mb-6">
                    <input 
                        type="text" 
                        id="card-search" 
                        placeholder="Recherchez une carte (ex: Pikachu, Charizard VMAX, Mewtwo EX)..."
                        class="search-input w-full py-4 px-6 pr-12 rounded-2xl text-white placeholder-slate-400 focus:outline-none"
                        onkeypress="handleSearch(event)"
                    >
                    <button onclick="searchCards()" class="absolute right-4 top-1/2 transform -translate-y-1/2 text-yellow-400 hover:text-yellow-300 transition-colors">
                        <i class="fas fa-search text-xl"></i>
                    </button>
                </div>
                
                <!-- Quick Search Tags -->
                <div class="flex flex-wrap justify-center gap-2">
                    <button onclick="quickSearch('Pikachu')" class="px-3 py-1 bg-yellow-500 hover:bg-yellow-600 text-white rounded-lg transition-colors text-sm">Pikachu</button>
                    <button onclick="quickSearch('Charizard')" class="px-3 py-1 bg-red-500 hover:bg-red-600 text-white rounded-lg transition-colors text-sm">Charizard</button>
                    <button onclick="quickSearch('Mewtwo')" class="px-3 py-1 bg-purple-500 hover:bg-purple-600 text-white rounded-lg transition-colors text-sm">Mewtwo</button>
                    <button onclick="quickSearch('Rayquaza')" class="px-3 py-1 bg-green-500 hover:bg-green-600 text-white rounded-lg transition-colors text-sm">Rayquaza</button>
                    <button onclick="quickSearch('Lugia')" class="px-3 py-1 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors text-sm">Lugia</button>
                </div>
            </div>
        </div>
    </section>

    <!-- Results Section -->
    <section class="py-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <!-- Loading State -->
            <div id="loading-state" class="text-center py-12 hidden">
                <i class="fas fa-spinner loading-spinner text-4xl text-yellow-400 mb-4"></i>
                <p class="text-white text-lg">Recherche des cartes...</p>
            </div>

            <!-- Results Grid -->
            <div id="results-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                <!-- Results will be populated here -->
            </div>

            <!-- No Results State -->
            <div id="no-results" class="text-center py-12 hidden">
                <i class="fas fa-search text-4xl text-slate-400 mb-4"></i>
                <h3 class="text-white text-xl font-bold mb-2">Aucune carte trouvée</h3>
                <p class="text-slate-400">Essayez avec un autre nom de carte ou vérifiez l'orthographe.</p>
            </div>
        </div>
    </section>

    <!-- Price History Modal -->
    <div id="price-modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="estimateur-card rounded-2xl p-8 max-w-4xl w-full max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-6">
                    <h2 id="modal-title" class="text-2xl font-bold text-white">Historique des prix</h2>
                    <button onclick="closeModal()" class="text-slate-400 hover:text-white transition-colors">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                
                <!-- Card Details -->
                <div id="modal-card-details" class="flex items-center space-x-4 mb-6">
                    <!-- Card info will be populated here -->
                </div>
                
                <!-- Price Chart -->
                <div class="price-history-chart rounded-xl p-6 mb-6">
                    <h3 class="text-lg font-semibold text-white mb-4">Évolution du prix</h3>
                    <div id="price-chart" class="h-64 flex items-center justify-center text-slate-400">
                        <div class="text-center">
                            <i class="fas fa-chart-line text-3xl mb-2"></i>
                            <p>Graphique de l'évolution des prix</p>
                        </div>
                    </div>
                </div>
                
                <!-- Price Details -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="estimateur-card rounded-xl p-4 text-center">
                        <div class="text-slate-400 text-sm mb-1">Prix actuel</div>
                        <div id="current-price" class="text-2xl font-bold text-green-400">-</div>
                    </div>
                    <div class="estimateur-card rounded-xl p-4 text-center">
                        <div class="text-slate-400 text-sm mb-1">Variation (30j)</div>
                        <div id="price-change" class="text-2xl font-bold">-</div>
                    </div>
                    <div class="estimateur-card rounded-xl p-4 text-center">
                        <div class="text-slate-400 text-sm mb-1">Prix le plus haut</div>
                        <div id="highest-price" class="text-2xl font-bold text-yellow-400">-</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-slate-900 border-t border-slate-700 py-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center">
                <div class="flex items-center justify-center space-x-2 mb-4">
                    <div class="w-8 h-8 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full flex items-center justify-center">
                        <i class="fas fa-bolt text-white text-sm"></i>
                    </div>
                    <span class="text-2xl font-bold text-white">Pokémon Community</span>
                </div>
                <p class="text-slate-400 mb-6">La communauté ultime pour les fans de Pokémon</p>
                <div class="flex justify-center space-x-6 mb-6">
                    <a href="#" class="text-slate-400 hover:text-white transition-colors">
                        <i class="fab fa-twitter text-xl"></i>
                    </a>
                    <a href="#" class="text-slate-400 hover:text-white transition-colors">
                        <i class="fab fa-discord text-xl"></i>
                    </a>
                    <a href="#" class="text-slate-400 hover:text-white transition-colors">
                        <i class="fab fa-youtube text-xl"></i>
                    </a>
                    <a href="#" class="text-slate-400 hover:text-white transition-colors">
                        <i class="fab fa-instagram text-xl"></i>
                    </a>
                </div>
                <p class="text-slate-500 text-sm">© 2025 Pokémon Community. Tous droits réservés.</p>
            </div>
        </div>
    </footer>

    <script>
        let priceCache = new Map();
        let searchCache = new Map();

        function handleSearch(event) {
            if (event.key === 'Enter') {
                searchCards();
            }
        }

        function quickSearch(term) {
            document.getElementById('card-search').value = term;
            searchCards();
        }

        async function searchCards() {
            const searchTerm = document.getElementById('card-search').value.trim();
            if (!searchTerm) return;

            const loadingState = document.getElementById('loading-state');
            const resultsGrid = document.getElementById('results-grid');
            const noResults = document.getElementById('no-results');

            // Show loading state
            loadingState.classList.remove('hidden');
            resultsGrid.innerHTML = '';
            noResults.classList.add('hidden');

            try {
                // Check cache first
                if (searchCache.has(searchTerm)) {
                    displayResults(searchCache.get(searchTerm));
                    loadingState.classList.add('hidden');
                    return;
                }

                // Search in Pokemon TCG API
                const response = await fetch(`https://api.pokemontcg.io/v2/cards?q=name:${encodeURIComponent(searchTerm)}*&pageSize=50`, {
                    headers: {
                        'Accept': 'application/json'
                    }
                });

                if (!response.ok) {
                    throw new Error('API error');
                }

                const data = await response.json();
                const cards = data.data || [];

                // Cache results
                searchCache.set(searchTerm, cards);

                // Display results
                displayResults(cards);

            } catch (error) {
                console.error('Error searching cards:', error);
                showError();
            } finally {
                loadingState.classList.add('hidden');
            }
        }

        function displayResults(cards) {
            const resultsGrid = document.getElementById('results-grid');
            const noResults = document.getElementById('no-results');

            if (cards.length === 0) {
                noResults.classList.remove('hidden');
                return;
            }

            resultsGrid.innerHTML = cards.map((card, index) => {
                const price = getCardPrice(card);
                const rarityClass = getRarityClass(card.rarity);
                
                return `
                    <div class="estimateur-card rounded-2xl p-6 fade-in cursor-pointer" 
                         style="animation-delay: ${index * 0.1}s"
                         onclick="showPriceHistory('${card.id}', '${card.name}', '${card.images?.large || card.images?.small}', '${card.set?.name}', '${card.rarity}', ${price})">
                        
                        <!-- Card Image -->
                        <div class="relative mb-4">
                            <img src="${card.images?.small || card.images?.large}" 
                                 alt="${card.name}" 
                                 class="w-full h-auto rounded-lg shadow-lg hover:shadow-2xl transition-shadow"
                                 onerror="this.src='https://via.placeholder.com/245x342/1e293b/ffffff?text=${encodeURIComponent(card.name)}'">
                            <div class="absolute top-2 right-2">
                                <span class="px-2 py-1 ${rarityClass} text-white text-xs font-semibold rounded">
                                    ${card.rarity || 'Unknown'}
                                </span>
                            </div>
                        </div>
                        
                        <!-- Card Info -->
                        <div class="space-y-2">
                            <h3 class="text-white font-bold text-lg truncate">${card.name}</h3>
                            <div class="text-slate-400 text-sm">
                                <div class="flex justify-between">
                                    <span>Set:</span>
                                    <span class="truncate">${card.set?.name || 'Unknown'}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span>Number:</span>
                                    <span>${card.number || '-'}</span>
                                </div>
                            </div>
                            
                            <!-- Price Display -->
                            <div class="pt-3 border-t border-slate-600">
                                <div class="flex justify-between items-center">
                                    <span class="text-slate-400 text-sm">Prix estimé:</span>
                                    <span class="price-badge text-white px-3 py-1 rounded-lg font-bold">
                                        ${price > 0 ? `$${price.toFixed(2)}` : 'N/A'}
                                    </span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Click Indicator -->
                        <div class="absolute bottom-2 right-2 text-slate-400 hover:text-yellow-400 transition-colors">
                            <i class="fas fa-chart-line text-sm"></i>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function getCardPrice(card) {
            // Mock price calculation based on rarity and set
            const basePrices = {
                'Common': 0.25,
                'Uncommon': 0.50,
                'Rare': 2.00,
                'Rare Holo': 5.00,
                'Rare Holo EX': 15.00,
                'Rare Holo GX': 20.00,
                'Rare Holo V': 25.00,
                'Rare Holo VMAX': 35.00,
                'Rare Rainbow': 50.00,
                'Rare Secret': 75.00,
                'Rare Ultra': 100.00,
                'Illustration Rare': 150.00,
                'Special Illustration Rare': 200.00,
                'Hyper Rare': 300.00,
                'Amazing Rare': 250.00
            };

            const rarity = card.rarity || 'Common';
            const basePrice = basePrices[rarity] || 0.50;
            
            // Add some randomness to simulate real market
            const variation = (Math.random() - 0.5) * 0.4; // ±20%
            return basePrice * (1 + variation);
        }

        function getRarityClass(rarity) {
            const rarityMap = {
                'Common': 'rarity-common',
                'Uncommon': 'rarity-uncommon',
                'Rare': 'rarity-rare',
                'Rare Holo': 'rarity-rare',
                'Rare Holo EX': 'rarity-mythic',
                'Rare Holo GX': 'rarity-mythic',
                'Rare Holo V': 'rarity-mythic',
                'Rare Holo VMAX': 'rarity-mythic',
                'Rare Rainbow': 'rarity-secret',
                'Rare Secret': 'rarity-secret',
                'Rare Ultra': 'rarity-secret',
                'Illustration Rare': 'rarity-secret',
                'Special Illustration Rare': 'rarity-secret',
                'Hyper Rare': 'rarity-secret',
                'Amazing Rare': 'rarity-secret'
            };
            return rarityMap[rarity] || 'rarity-common';
        }

        function showPriceHistory(cardId, cardName, cardImage, cardSet, cardRarity, currentPrice) {
            const modal = document.getElementById('price-modal');
            const modalTitle = document.getElementById('modal-title');
            const modalCardDetails = document.getElementById('modal-card-details');
            const currentPriceEl = document.getElementById('current-price');
            const priceChangeEl = document.getElementById('price-change');
            const highestPriceEl = document.getElementById('highest-price');

            // Update modal content
            modalTitle.textContent = `Historique des prix - ${cardName}`;
            
            modalCardDetails.innerHTML = `
                <img src="${cardImage}" alt="${cardName}" class="w-20 h-auto rounded-lg">
                <div>
                    <h3 class="text-white font-bold text-xl">${cardName}</h3>
                    <p class="text-slate-400">${cardSet} • ${cardRarity}</p>
                </div>
            `;

            // Generate mock price history
            const priceHistory = generatePriceHistory(currentPrice);
            const highestPrice = Math.max(...priceHistory.map(p => p.price));
            const priceChange30d = ((currentPrice - priceHistory[0].price) / priceHistory[0].price * 100);

            currentPriceEl.textContent = `$${currentPrice.toFixed(2)}`;
            highestPriceEl.textContent = `$${highestPrice.toFixed(2)}`;
            
            const changeColor = priceChange30d >= 0 ? 'text-green-400' : 'text-red-400';
            const changeIcon = priceChange30d >= 0 ? 'fa-arrow-up' : 'fa-arrow-down';
            priceChangeEl.innerHTML = `
                <span class="${changeColor}">
                    <i class="fas ${changeIcon} mr-1"></i>
                    ${Math.abs(priceChange30d).toFixed(1)}%
                </span>
            `;

            // Show modal
            modal.classList.remove('hidden');
            
            // Generate chart (mock)
            generatePriceChart(priceHistory);
        }

        function generatePriceHistory(currentPrice) {
            const history = [];
            const days = 30;
            let basePrice = currentPrice * (0.7 + Math.random() * 0.6); // ±30% variation
            
            for (let i = days; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                
                // Add some realistic price fluctuations
                const volatility = 0.05; // 5% daily volatility
                const change = (Math.random() - 0.5) * volatility;
                basePrice = basePrice * (1 + change);
                
                history.push({
                    date: date.toISOString().split('T')[0],
                    price: Math.max(basePrice, 0.10) // Minimum price
                });
            }
            
            return history;
        }

        function generatePriceChart(priceHistory) {
            const chartContainer = document.getElementById('price-chart');
            
            // Simple visual representation (mock chart)
            const maxPrice = Math.max(...priceHistory.map(p => p.price));
            const minPrice = Math.min(...priceHistory.map(p => p.price));
            const priceRange = maxPrice - minPrice;
            
            let chartHTML = '<div class="w-full h-full flex items-end justify-between px-2">';
            
            priceHistory.forEach((point, index) => {
                const height = ((point.price - minPrice) / priceRange) * 80; // 80% max height
                const barColor = index > 0 && point.price > priceHistory[index - 1].price ? 'bg-green-400' : 'bg-red-400';
                
                chartHTML += `
                    <div class="flex-1 mx-px">
                        <div class="${barColor} rounded-t transition-all duration-300 hover:bg-opacity-80" 
                             style="height: ${height}%;"
                             title="${point.date}: $${point.price.toFixed(2)}">
                        </div>
                    </div>
                `;
            });
            
            chartHTML += '</div>';
            chartHTML += `
                <div class="absolute bottom-2 left-2 right-2 flex justify-between text-xs text-slate-400">
                    <span>30 jours</span>
                    <span>Aujourd'hui</span>
                </div>
            `;
            
            chartContainer.innerHTML = chartHTML;
            chartContainer.classList.add('relative');
        }

        function closeModal() {
            document.getElementById('price-modal').classList.add('hidden');
        }

        function showError() {
            const resultsGrid = document.getElementById('results-grid');
            const noResults = document.getElementById('no-results');
            
            resultsGrid.innerHTML = `
                <div class="col-span-full text-center text-red-400 py-8">
                    <i class="fas fa-exclamation-triangle text-4xl mb-4"></i>
                    <h3 class="text-xl font-bold mb-2">Erreur de recherche</h3>
                    <p class="text-red-300">Impossible de récupérer les données. Veuillez réessayer.</p>
                    <button onclick="searchCards()" class="mt-4 px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors">
                        <i class="fas fa-redo mr-2"></i>Réessayer
                    </button>
                </div>
            `;
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Close modal when clicking outside
            document.getElementById('price-modal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeModal();
                }
            });

            // Load some popular cards on startup
            setTimeout(() => {
                quickSearch('Pikachu');
            }, 1000);
        });
    </script>
</body>
</html>